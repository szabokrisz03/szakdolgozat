@inject ISnackbar Snackbar

<div class="connecting-wi-div">
    <MudText class="wi-text">Kapcsolódó WI-k</MudText>
    
        <div class="wi-new">
            <MudNumericField class="wi-number" @ref="_numField" @bind-Value="WiNumber" Label="Wi szám" Variant="Variant.Outlined" Immediate="true" Clearable="true" DisableUnderLine="true" HideSpinButtons="true"></MudNumericField>
            <span class="wi-button-span">
                <MudButton class="wi-button" OnClick="@(() => AddWi())">+</MudButton>
                <MudButton class="wi-button" Disabled="true">New</MudButton>
            </span>
        </div>
    <MudCard class="wi" Elevation="0">


    @if (workItems != null)
    {
        @foreach (var item in workItems)
        {
            <MudField class="field" Variant="Variant.Text">
                <div class="wi-div">
                    <div class="wi-first-div">
                        <MudIcon Icon="@Icons.Material.Filled.Task" Size="Size.Small"></MudIcon>
                        <MudLink Href="@item.AzdoLink"  Target="_blank">#@item.Id- </MudLink>
                        <span>@item.Title</span>
                    </div>
                    <div class="wi-first-div">
                        <span>@((item.AssignedTo?.DisplayName == null) ? "-" : item.AssignedTo?.DisplayName)</span>
                        <span><b>Állapot: </b>@((item.ClearState == "") ? "-" : item.ClearState)</span>
                        <span><b>Módosítva: </b>@item.ChangedDate.ToString("yyyy.MM.dd")</span>
                    </div>
                        <MudIconButton class="expand-button" Icon="@Icons.Material.Filled.ExpandMore" OnClick="@(() => ShowConnectingWi(item.Id))"></MudIconButton>
                </div>
            </MudField>

                @if (item.IsOpen && workItemChildrens != null && workItemChildrens.Count != 0)
                {
                    @foreach (var wi in workItemChildrens)
                    {
                        <div class="conn-wi-div">
                            <div>
                                <MudLink Href="@item.AzdoLink" Target="_blank">#@wi.Id </MudLink>
                                <span>@wi.Title</span>
                            </div>
                            <div class="wi-first-div">
                                <span>@wi.AssignedTo?.DisplayName</span>
                                <span>@wi.State</span>
                                <span><b>Módosítva: </b>@wi.ChangedDate.ToString("yyyy.MM.dd")</span>
                                <span><b>Típus: </b>@wi.Type</span>
                            </div>
                        </div>
                    }
                }
            }

        }
        else
        {
            <MudProgressCircular class="loading-spinner" Size="Size.Small" Color="Color.Secondary" Indeterminate="true" />
        }
    </MudCard>
</div>